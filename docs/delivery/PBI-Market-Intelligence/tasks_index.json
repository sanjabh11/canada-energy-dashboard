{
  "tasks": [
    {
      "task_id": "PBI-Market-Intelligence-t1",
      "title": "Add LLM endpoint for market brief",
      "type": "code",
      "status": "Proposed",
      "files": ["supabase/functions/llm/index.ts"],
      "test_plan": {
        "unit_tests": ["Test LLM response shape"],
        "integration_tests": ["Test endpoint with market data"],
        "acceptance_criteria": ["Endpoint returns market briefings"]
      }
    },
    {
      "task_id": "PBI-Market-Intelligence-t2",
      "title": "Update UI for market intelligence",
      "type": "ui",
      "status": "Proposed",
      "files": ["src/components/MarketIntelligence.tsx"],
      "test_plan": {
        "ui_tests": ["Test component renders market data"],
        "acceptance_criteria": ["UI shows intelligence interface with LLM briefings"]
      }
    },
    {
      "task_id": "PBI-Market-Intelligence-t3",
      "title": "Integrate with market datasets and Perplexity",
      "type": "code",
      "status": "Proposed",
      "files": ["src/lib/dataStreamers.ts"],
      "test_plan": {
        "integration_tests": ["Test data streaming for market data and news"],
        "acceptance_criteria": ["Streamer fetches market data and RAG from Perplexity"]
      }
    },
    {
      "task_id": "PBI-Market-Intelligence-t4",
      "title": "Test endpoint and UI",
      "type": "test",
      "status": "Proposed",
      "files": [],
      "test_plan": {
        "end_to_end_tests": ["Run full flow from data to UI"],
        "acceptance_criteria": ["All components work together for market intelligence"]
      }
    },
    {
      "task_id": "PBI-Market-Intelligence-T1",
      "title": "Market briefings with short RAG and scenario narratives",
      "type": "code",
      "status": "InProgress",
      "files": ["supabase/functions/llm/index.ts", "src/components/MarketIntelligence.tsx", "src/lib/rag.ts", "tests/test_llm_endpoints.js"],
      "test_plan": {
        "unit": ["RAG builder returns ≥3 chunks; citation formatting function returns non-empty sources."],
        "integration": ["POST /llm/market-brief returns 200 with summary, drivers[], sources[]."],
        "manual": ["In MarketIntelligence.tsx, insights render within 3s with ≥1 citation."]
      }
    }
  ]
}
